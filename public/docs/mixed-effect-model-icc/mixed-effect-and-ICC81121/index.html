<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Mixed effect model simulation and ICC Data example: Mixed effect model was simulated using parameters obtained from a pilot data. Intraclass correlation coefficient was calculated from the mixed effect model to test the agreement between raters. In this example, videos as the subjects were assessed by different raters, each rater will be assigned to multiple videos. nstand is parameter for the number of videos which will be assessed by various raters (nraters).">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Mixed effect model simulation and ICC (R)" />
<meta property="og:description" content="Mixed effect model simulation and ICC Data example: Mixed effect model was simulated using parameters obtained from a pilot data. Intraclass correlation coefficient was calculated from the mixed effect model to test the agreement between raters. In this example, videos as the subjects were assessed by different raters, each rater will be assigned to multiple videos. nstand is parameter for the number of videos which will be assessed by various raters (nraters)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/mixed-effect-model-icc/mixed-effect-and-icc81121/" />
<meta property="article:published_time" content="2021-08-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-08-10T00:00:00+00:00" />
<title>Mixed effect model simulation and ICC (R) | Code Notes</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.da110f27d6a4d632dc8e162876b7216c5c1f82164fbdac7ff33021633767f034.css" >
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.0d4159201462ccf92abfecab716bb0b3f388f34ab98c42d1942d3f22019fefd8.js" ></script>

  <script defer src="/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js" ></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-XXXXXXXXX-X', 'auto');
	
	ga('send', 'pageview');
}
</script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Code Notes</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/blog-down/blog-down/" class="">Using R Blogdown for Site Building</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-31f51f1e983d3fcd191b1a670dd370c1" class="toggle"  />
    <label for="section-31f51f1e983d3fcd191b1a670dd370c1" class="flex justify-between">
      <a href="/docs/plot/" class="">Plot</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/plot/sankey/sankey-020722/" class="">Sankey diagram (R)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/plot/odds-ratio-forest-plot/odds-ratio-forest-plot/" class="">Odds Ratio Forest Plot (R)</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0a41e1f9be9b219b00fc23f1b7c32d3f" class="toggle"  />
    <label for="section-0a41e1f9be9b219b00fc23f1b7c32d3f" class="flex justify-between">
      <a href="/docs/psm/" class="">Propensity score methods</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/psm/psm/psm/" class="">Propensity score methods-I PS Matching (SAS)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/psm/ps-weighting/ps-weighting/" class="">Propensity score weighting methods (R)</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mixed-effect-model-icc/mixed-effect-and-icc81121/" class="active">Mixed effect model simulation and ICC (R)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/collinearity/collinearity/" class="">Collinearity (SAS)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/longitudinal-plot/longitudinal-plot/" class="">Longitudinal plot (SAS)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/power-linear-regression-model/simulation-to-calculate-power-in-linear-regression-model/" class="">Use simulation to calculate power in linear regression model (R)</a>
  

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var menu=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Mixed effect model simulation and ICC (R)</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  




  </aside>
  
 
      </header>

      
      
  <article class="markdown">


<div id="mixed-effect-model-simulation-and-icc" class="section level3">
<h3>Mixed effect model simulation and ICC</h3>
<p>Data example: Mixed effect model was simulated using parameters obtained from a pilot data. Intraclass correlation coefficient was calculated from the mixed effect model to test the agreement between raters. In this example, videos as the subjects were assessed by different raters, each rater will be assigned to multiple videos. nstand is parameter for the number of videos which will be assessed by various raters (nraters). Given the variation of the rating can be attributed to videos and raters. The mixed effect model in this simulation included videos and raters as two separate random intercepts. Intraclass correlation is calculated from the models with the simulated data. We varied the number of videos in the simulation. The ICC distribution plot from the simulated data showed that 60 videos has reached a more accurate estimate for ICC with the narrower range.</p>
<div class="figure">
<img src="/docs//mixed-effect-model-icc/iccplot.jpeg" />

</div>
<pre class="r"><code>video_fun = function( nstand = 30 ,# number of videos to rate
                      nraters = (nstand/10)*3,  #each rater rated 10 subjects (i.e.videos), and each subject is rated by 3 different raters.
                      #nraters = (nstand/4)*3  #each rater rated 4 subjects, and each subject is rated by 3 different raters.
                      nraterper=3 ,# the number of raters for each video; 
                      mu = 20.2,
                      sds =9.9,  # video random effect
                      sd =3.2 , # residual
                      rsd=3.6,  # rater random effect
                      nstandper=10
)
  
{
  #set.seed(201)
  rater_sample = sample(1:50, nraters, replace=F)
  rater = rep(rater_sample, each=10)  # each rater repeats 10 times, since each rater reviews 10subjects; 
  ratereff = rnorm(nraters, 0, rsd)  # rsd the rater random effect; each rater has an random intercept
  ratereff = rep(ratereff,each=10)
  
  #set.seed(1917)
  x = sample(1:nstand,nstand)
  subject_assingment = c(x, c(x[nstand], x[-nstand]),  c(x[(nstand - 1):nstand], x[1:(nstand - 2)]))
  
  
  standeff = rnorm(nstand, 0, sds)    
  standeff =c(standeff, c(standeff[nstand], standeff[-nstand]),  c(standeff[(nstand - 1):nstand], standeff[1:(nstand - 2)]))  # sds the video random effect ; each video has an random intercept  
  
  
  ploteff = rnorm(nstand*nraterper, 0, sd)  # sd the overall residual effect 
  
  dat2 = data.frame(rater,ratereff,subject_assingment,standeff,ploteff)
  
  dat2$resp = with(dat2, mu + standeff +ratereff+ploteff )
  
  dat2$rater &lt;-as.factor(dat2$rater)
  dat2$subject_assingment = as.factor(dat2$subject_assingment)
  
  fit1= lmer(resp ~  1+(1|rater)+(1|subject_assingment), data = dat2, control=lmerControl(optimizer=&quot;bobyqa&quot;,  optCtrl=list(maxfun=2e5)))
  vcv_= as.data.frame(t((as.data.frame (VarCorr (fit1))[c(&#39;grp&#39;,&quot;vcov&quot;)]) [,-1]) )    # exact the variation, transpose the group variable and variance columns. 
  vcv &lt;- as.data.frame (VarCorr (fit1)) 
  names(vcv_) &lt;- vcv[,1]    # assign names for the variance in vcv_ data
  icc=vcv_$subject_assingment  / (vcv_$subject_assingment+vcv_$rater +vcv_$Residual)  
  # calculate the ICC, which the the variance from the subjects (videos) divided by the total variances. 
} 



library (dplyr)
library (lme4)

# call the function to calculate the ICC; 
sims = replicate(100, video_fun(), simplify = FALSE )

library(purrr) # v. 0.3.3
suppressPackageStartupMessages( library(dplyr) ) # v. 0.8.3
library(ggplot2) # v. 3.2.1

stand_sims = c(30,60) %&gt;%
  set_names() %&gt;%
  map(~replicate(100, video_fun(nstand = .x) ) )    # repeat the function for 100 times with different nstand (# of videos)

# convert the list to dataframe
df3=as.data.frame(do.call(cbind, stand_sims))
summary (df3$`30`)  # summarize the ICC ranges by samples size

library (reshape2)
# reshape the dataframe
df3 &lt;- melt(df3)

# plot the distribution by various number of videos
# ICC=0.81 is the ICC from pilot data and used as the reference here. 
ggplot(df3, aes(x = value) ) +xlim(0.1,1.0)+
  geom_density(fill = &quot;blue&quot;, alpha = .25) +
  facet_wrap(~variable) +
  geom_vline(xintercept = 0.81)</code></pre>
</div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function select(element){const selection=window.getSelection();const range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range);}
document.querySelectorAll("pre code").forEach(code=>{code.addEventListener("click",function(event){select(code.parentElement);if(navigator.clipboard){navigator.clipboard.writeText(code.parentElement.textContent);}});});})();</script>


 
        
      </footer>

      
  
  <div class="book-comments">
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "my-site" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  



 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












